<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BeReal Museum (Posts)</title>
  <link rel="icon" type="image/png" href="BeRealMuseum.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-body: #0a0a0a;
      /* Deep museum floor */
      --bg-card: #141414;
      /* Exhibit frame dark */
      --text-main: #f0f0f0;
      /* Bright focus */
      --text-muted: #999;
      --accent: #c5a059;
      /* Museum Gold */
      --border: #2a2a2a;
      --radius-btn: 4px;
      --radius-card: 4px;
      /* More architectural */
      --font-main: 'Outfit', system-ui, sans-serif;
    }

    body::after {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at center, transparent 30%, rgba(0, 0, 0, 0.4) 100%);
      pointer-events: none;
      z-index: 100;
    }

    body {
      font-family: var(--font-main);
      background: var(--bg-body);
      color: var(--text-main);
      margin: 0;
      -webkit-font-smoothing: antialiased;
    }

    header {
      padding: 16px 20px;
      border-bottom: 1px solid #ddd;
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    header h1 {
      margin: 0;
      font-size: 18px;
    }

    main {
      padding: 16px 20px;
    }

    .muted {
      color: #666;
      font-size: 13px;
    }

    .tabs {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin: 12px 0;
    }

    .tab {
      border: 1px solid var(--border);
      background: var(--bg-card);
      padding: 8px 16px;
      border-radius: 999px;
      /* Pill */
      cursor: pointer;
      user-select: none;
      font-weight: 500;
      font-size: 14px;
      transition: all 0.2s ease;
      color: var(--text-muted);
    }

    .tab:hover {
      background: #eee;
    }

    .tab.active {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .btn {
      border: 1px solid var(--border);
      background: var(--bg-card);
      padding: 8px 14px;
      border-radius: var(--radius-btn);
      cursor: pointer;
      font-family: var(--font-main);
      font-weight: 500;
      font-size: 14px;
      transition: all 0.15s ease;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
      color: var(--text-main);
    }

    .btn:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      border-color: #ccc;
    }

    .btn:disabled {
      opacity: .5;
      cursor: not-allowed;
    }

    .tile {
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid #eee;
      background: #fafafa;
      cursor: pointer;
    }

    .meta {
      padding: 10px;
      font-size: 12px;
      color: #444;
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }

    .meta span {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .frame {
      position: relative;
      width: 100%;
      height: 240px;
      background: #000;
    }

    .frame img.back {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .frame img.front {
      position: absolute;
      right: 10px;
      bottom: 10px;
      width: 80px;
      height: 108px;
      object-fit: cover;
      border-radius: 12px;
      border: 2px solid rgba(255, 255, 255, .95);
      box-shadow: 0 8px 18px rgba(0, 0, 0, .35);
      background: #222;
    }

    #mosaicWrap {
      border: 1px solid #ddd;
      border-radius: 12px;
      overflow: hidden;
    }

    #mosaic {
      width: 100%;
      height: 72vh;
      display: block;
      background: #111;
      touch-action: none;
    }

    .row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }

    #favoritesStrip,
    #timelineStrip {
      display: flex;
      gap: 12px;
      overflow-x: auto;
      padding: 6px 2px 12px;
      scroll-snap-type: x mandatory;
    }

    .stripCard {
      min-width: 260px;
      scroll-snap-align: start;
    }

    #timelineGrid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 12px;
    }

    /* Story modal */
    #storyModal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .86);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 18px;
    }

    #storyModal.open {
      display: flex;
    }

    .storyBox {
      width: min(980px, 100%);
      height: min(86vh, 820px);
      position: relative;
      border-radius: 18px;
      overflow: hidden;
      background: #000;
    }

    .storyBox img.back {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
      background: #000;
    }

    .storyBox img.front {
      position: absolute;
      right: 16px;
      bottom: 16px;
      width: 120px;
      height: 160px;
      object-fit: cover;
      border-radius: 14px;
      border: 2px solid rgba(255, 255, 255, .95);
      box-shadow: 0 10px 22px rgba(0, 0, 0, .35);
      background: #222;
    }

    .storyTop {
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
      padding: 12px 14px;
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(to bottom, rgba(0, 0, 0, .75), rgba(0, 0, 0, 0));
      color: #fff;
      font-size: 14px;
      z-index: 10;
      pointer-events: auto;
    }

    .storyLabel {
      font-weight: 600;
    }

    .storyMeta {
      opacity: .85;
      font-size: 13px;
    }

    .storyBtn {
      border: 1px solid rgba(255, 255, 255, .25);
      background: rgba(255, 255, 255, .12);
      color: #fff;
      padding: 8px 10px;
      border-radius: 999px;
      cursor: pointer;
    }

    .storyNav {
      z-index: 1;
      top: 64px;
      left: 0;
      right: 0;
      bottom: 0;
      position: absolute;
      display: grid;
      grid-template-columns: 1fr 1fr;
    }

    .storyNav div {
      cursor: pointer;
    }

    .hint {
      color: #666;
      font-size: 12px;
    }

    /* ===== New Favorites Modes Styling ===== */

    /* Highlight Reel modal */
    #reelModal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      background: rgba(0, 0, 0, .92);
      padding: 18px;
    }

    #reelModal.open {
      display: flex;
    }

    .reelBox {
      width: min(980px, 100%);
      height: min(86vh, 820px);
      border-radius: 18px;
      overflow: hidden;
      background: #000;
      position: relative;
    }

    .reelMedia {
      position: absolute;
      inset: 0;
      overflow: hidden;
      background: #000;
    }

    .reelMedia img.back {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform-origin: center;
      animation: kb 8s linear forwards;
      opacity: 0;
      transition: opacity .45s ease;
    }

    .reelMedia img.back.show {
      opacity: 1;
    }

    @keyframes kb {
      from {
        transform: scale(1) translate(0, 0);
      }

      to {
        transform: scale(1.08) translate(-2%, -2%);
      }
    }

    .reelMedia img.front {
      position: absolute;
      right: 16px;
      bottom: 16px;
      width: 120px;
      height: 160px;
      object-fit: cover;
      border-radius: 14px;
      border: 2px solid rgba(255, 255, 255, .95);
      box-shadow: 0 10px 22px rgba(0, 0, 0, .35);
      background: #222;
      opacity: 0;
      transition: opacity .45s ease;
    }

    .reelMedia img.front.show {
      opacity: 1;
    }

    .reelTop {
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
      padding: 12px 14px;
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: center;
      background: linear-gradient(to bottom, rgba(0, 0, 0, .78), rgba(0, 0, 0, 0));
      color: #fff;
      z-index: 5;
    }

    .reelBottom {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 14px 16px;
      background: linear-gradient(to top, rgba(0, 0, 0, .78), rgba(0, 0, 0, 0));
      color: #fff;
      z-index: 5;
    }

    .reelLabel {
      font-weight: 650;
      font-size: 16px;
      opacity: 0;
      transition: opacity .35s ease;
    }

    .reelLabel.show {
      opacity: 1;
    }

    .reelMeta {
      opacity: .85;
      font-size: 13px;
      margin-top: 2px;
    }

    /* Museum wall */
    #museumWallWrap {
      display: none;
    }

    .wallToolbar {
      margin: 0 0 12px;
    }

    /* Book Preview */
    #bookWrap {
      display: none;
      gap: 14px;
    }

    #bookSidebar {
      width: 240px;
      min-width: 220px;
      border-right: 1px solid #eee;
      padding-right: 10px;
    }

    #bookSidebar .chapterBtn {
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 10px 10px;
      margin: 0 0 10px;
      cursor: pointer;
      background: #fff;
      color: #333;
      transition: all 0.2s ease;
    }

    #bookSidebar .chapterBtn:hover {
      background: #f5f5f5;
      border-color: #c5a059;
    }

    #bookSidebar .chapterBtn.active {
      background: #c5a059;
      color: #000;
      border-color: #c5a059;
      font-weight: 600;
    }

    #bookMain {
      flex: 1;
      min-width: 0;
    }

    .bookSidebar {
      width: 240px;
      padding: 16px;
      border-right: 1px solid #ddd;
      overflow-y: auto;
      background: #fdfdfd;
    }

    .bookPageHost {
      flex: 1;
      padding: 40px;
      overflow-y: auto;
      background: #eee;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 40px;
    }

    /* Yearbook Spread Styling */
    .bookSpread {
      display: flex;
      gap: 0;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      background: #fff;
      transition: transform 0.3s ease;
    }

    .bookPage {
      width: 440px;
      min-height: 580px;
      padding: 30px;
      background: #fff;
      display: flex;
      flex-direction: column;
      position: relative;
      border: 1px solid #eee;
    }

    .bookPage.left {
      border-right: 1px solid #ddd;
      border-radius: 4px 0 0 4px;
    }

    .bookPage.right {
      border-left: 1px solid #ddd;
      border-radius: 0 4px 4px 0;
    }

    .titlePage {
      width: 440px;
      height: 580px;
      background: #111;
      color: #fff;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 40px;
      border-radius: 4px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    }

    .dividerPage {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      height: 100%;
    }

    .bookControls {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      margin: 0 0 12px;
    }

    .bookGrid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 25px;
      flex: 1;
    }

    .bookPhoto {
      display: flex;
      flex-direction: column;
      border: 1px solid #e0e0e0;
      border-radius: 12px;
      overflow: hidden;
      background: #ffffff;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      transition: transform 0.3s ease;
    }

    .bookPhoto:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }

    .bookPhoto .frame {
      height: 240px;
      background: #f8f8f8;
      position: relative;
    }

    .bookCaption {
      background: #fff;
      border-top: 1px solid #f0f0f0;
      flex-grow: 1;
    }

    .bookPage {
      background: white;
      color: #333;
    }

    .titlePage {
      background: #fff;
      color: #111;
      border: 1px solid #f0f0f0;
    }

    /* Realmoji Wall Interactive Bubble Layout */
    /* Realmoji Wall Interactive Bubble Layout */
    .realmojiWall {
      display: flex;
      flex-direction: column;
      gap: 40px;
      padding: 60px 20px;
      min-height: calc(100vh - 120px);
      background: var(--bg-body);
    }

    .realmojiGrid {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      justify-content: center;
      perspective: 1200px;
    }

    .wallSectionHeader {
      width: 100%;
      text-align: center;
      margin-top: 20px;
    }

    .wallSectionHeader h3 {
      font-size: 24px;
      font-weight: 600;
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    .wallSectionHeader h3::before,
    .wallSectionHeader h3::after {
      content: "";
      height: 1px;
      flex-grow: 1;
      background: linear-gradient(to right, transparent, var(--accent), transparent);
      max-width: 200px;
    }

    .emojiBubble {
      --size: 140px;
      width: var(--size);
      height: var(--size);
      border-radius: 50%;
      background: #1a1a1a;
      border: 4px solid #333;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      overflow: hidden;
      cursor: pointer;
      position: relative;
      transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      animation: floatBubble var(--duration, 6s) infinite ease-in-out;
      animation-delay: var(--delay, 0s);
      transform: rotate(var(--rotation, 0deg));
    }

    .emojiBubble.isFavorite {
      border-color: var(--accent);
      box-shadow: 0 0 20px rgba(197, 160, 89, 0.3);
    }

    .emojiBubble::after {
      content: '';
      position: absolute;
      top: 10%;
      left: 15%;
      width: 25%;
      height: 25%;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      filter: blur(4px);
    }

    .emojiBubble:hover {
      transform: scale(1.3) translateY(-20px) rotate(var(--hover-rotation, 5deg));
      box-shadow: 0 30px 60px rgba(0, 0, 0, 0.8);
      z-index: 100;
      border-color: var(--accent);
      animation-play-state: paused;
    }

    .bubbleHeart {
      position: absolute;
      bottom: 10px;
      right: 10px;
      width: 32px;
      height: 32px;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(5px);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #888;
      font-size: 16px;
      transition: all 0.3s ease;
      z-index: 10;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .emojiBubble:hover .bubbleHeart {
      opacity: 1;
      transform: scale(1.1);
    }

    .emojiBubble.isFavorite .bubbleHeart {
      color: #ff4d4d;
      background: rgba(255, 255, 255, 0.9);
      border-color: #ff4d4d;
      opacity: 1;
    }

    .bubbleHeart:hover {
      transform: scale(1.3) !important;
      background: #fff;
      color: #ff4d4d;
    }

    .emojiBubble img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      pointer-events: none;
    }

    /* RealMoji Lightbox Modal */
    #realmojiModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.95);
      z-index: 10000;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      animation: fadeIn 0.3s ease;
    }

    #realmojiModal.open {
      display: flex;
    }

    #realmojiModal img {
      max-width: 90vw;
      max-height: 90vh;
      width: auto;
      height: auto;
      border-radius: 20px;
      box-shadow: 0 30px 100px rgba(0, 0, 0, 0.8);
      animation: zoomIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    #realmojiModal .closeBtn {
      position: absolute;
      top: 30px;
      right: 30px;
      width: 50px;
      height: 50px;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      color: #fff;
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      backdrop-filter: blur(10px);
    }

    #realmojiModal .closeBtn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.1);
    }

    @keyframes zoomIn {
      from {
        opacity: 0;
        transform: scale(0.5);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes floatBubble {

      0%,
      100% {
        transform: translateY(0) rotate(var(--rotation, 0deg));
      }

      50% {
        transform: translateY(-25px) rotate(calc(var(--rotation, 0deg) + 5deg));
      }
    }

    /* Chart Tooltip */
    #chartTooltip {
      position: fixed;
      display: none;
      pointer-events: none;
      background: #000;
      color: #fff;
      padding: 10px;
      border-radius: 12px;
      font-size: 11px;
      z-index: 10000;
      width: 140px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      flex-direction: column;
      align-items: center;
      text-align: center;
      transform: translate(-50%, -100%);
      margin-top: -15px;
    }

    #chartTooltip img {
      width: 120px;
      height: 160px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 8px;
      background: #222;
    }

    #chartTooltip .ttDate {
      font-weight: 700;
      font-size: 13px;
    }

    #chartTooltip .ttTime {
      opacity: 0.7;
    }

    #chartTooltip .ttLabel {
      font-weight: 700;
      font-size: 14px;
      margin-bottom: 2px;
    }

    #chartTooltip .ttSub {
      font-size: 12px;
      opacity: 0.8;
    }

    @media print {

      header,
      .tabs,
      .row,
      .view {
        width: 100%;
        height: 100%;
      }

      .hidden {
        display: none !important;
      }


      /* World Tour Popup Styles */
      .leaflet-popup-content-wrapper {
        background: #000 !important;
        color: #fff !important;
        border-radius: 16px !important;
        padding: 0 !important;
      }

      .leaflet-popup-content {
        margin: 0 !important;
        width: auto !important;
      }

      .leaflet-popup-tip {
        background: #000 !important;
      }

      .leaflet-container a.leaflet-popup-close-button {
        color: #fff !important;
        padding: 8px !important;
      }

      #view-favorites {
        display: block !important;
      }

      #bookSidebar,
      .bookControls,
      .bookPageInfo {
        display: none !important;
      }

      .bookPageHost {
        background: none !important;
        padding: 0 !important;
        display: block !important;
        overflow: visible !important;
      }

      .bookSpread {
        display: block !important;
        box-shadow: none !important;
        margin: 0 !important;
        page-break-after: always;
      }

      .bookPage {
        width: 100% !important;
        min-height: 0 !important;
        height: auto !important;
        page-break-after: always;
        border: none !important;
        padding: 1in !important;
      }

      .titlePage {
        width: 100% !important;
        height: 100vh !important;
        page-break-after: always;
      }

      body {
        margin: 0;
      }
    }

    /* Eras */
    #eraWrap {
      display: none;
    }

    .eraTwoCol {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }

    @media (max-width: 920px) {
      .eraTwoCol {
        grid-template-columns: 1fr;
      }
    }

    .eraCard {
      border: 1px solid #222;
      border-radius: 14px;
      padding: 12px;
      background: #141414;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4);
    }

    .eraCard h3 {
      margin: 0 0 4px;
      font-size: 14px;
      color: var(--accent);
    }

    .eraCard .muted {
      margin-top: 4px;
      color: #999;
    }

    .eraListItem {
      border: 1px solid #222;
      border-radius: 12px;
      padding: 10px;
      margin: 10px 0 0;
      display: flex;
      background: #141414;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
    }

    .eraWarn {
      color: #b45309;
      font-size: 12px;
    }

    /* ===== Museum Wall v2 (classy frames + varied sizes) ===== */

    #museumWallWrap {
      display: none;
    }

    .museumWall {
      /* Gallery Light Theme */
      padding: 18px;
      border-radius: 4px;
      /* Slight rounding on wall itself */
      background:
        radial-gradient(1200px 600px at 20% 0%, rgba(255, 255, 255, 0.4), transparent 60%),
        linear-gradient(180deg, #eaeae5, #dedbd0);
      border: 1px solid #dcdcdc;
      box-shadow:
        inset 0 0 60px rgba(0, 0, 0, 0.05),
        0 12px 40px rgba(0, 0, 0, 0.15);
      overflow: hidden;
    }

    /* Use CSS grid for deliberate "wall" composition */
    .museumWallGrid {
      display: grid;
      gap: 16px;
      margin-bottom: 16px;
      /* Horizontal scrolling magic */
      grid-auto-flow: column dense;
      /* 3:4 Aspect Ratio Base Unit: 180px x 240px */
      grid-template-rows: repeat(6, 240px);
      /* 6 rows of fixed height */
      grid-auto-columns: 180px;
      /* Base column width */

      overflow-x: auto;
      overflow-y: hidden;
      scroll-snap-type: x mandatory;
      padding-bottom: 10px;

      /* Ensure it takes up space horizontally but fits vertically */
      height: calc(6 * 240px + 5 * 16px + 20px);
    }

    /* Adjust container to allow scroll */
    .museumWall {
      padding: 18px;
      border-radius: 18px;
      /* Background same as before */
      background:
        radial-gradient(1200px 600px at 20% 0%, rgba(255, 255, 255, .10), transparent 60%),
        radial-gradient(900px 500px at 80% 20%, rgba(255, 255, 255, .08), transparent 60%),
        linear-gradient(180deg, #171717, #111);
      border: 1px solid rgba(255, 255, 255, .06);
      box-shadow: 0 18px 60px rgba(0, 0, 0, .35);
      overflow: hidden;
      /* Hide outer overflow */
    }

    /* Size variants - mapped to row/column spans 
       Standard unit: 1x1 = 180px x 180px
    */
    .wallSize-hero {
      grid-column: span 3;
      grid-row: span 3;
    }

    .wallSize-large {
      grid-column: span 2;
      grid-row: span 2;
    }

    .wallSize-medium {
      grid-column: span 2;
      grid-row: span 2;
    }

    .wallSize-small {
      grid-column: span 1;
      grid-row: span 1;
    }

    .wallSize-mini {
      grid-column: span 1;
      grid-row: span 1;
    }

    /* Remove old media queries that changed column count since we are row-based now */
    /* Adjust row heights for smaller screens if needed to fit vertical space */
    /* Adjust row heights for smaller screens if needed to fit vertical space
       Maintain 3:4 ratio for smaller screens too
    */
    @media (max-height: 900px) {
      .museumWallGrid {
        /* Base 140px width -> 186px height? Let's try 140x180 approx */
        grid-template-rows: repeat(6, 186px);
        grid-auto-columns: 140px;
        height: calc(6 * 186px + 5 * 16px + 20px);
      }
    }

    @media (max-height: 700px) {
      .museumWallGrid {
        /* Base 110px width -> 146px height */
        grid-template-rows: repeat(6, 146px);
        grid-auto-columns: 110px;
        height: calc(6 * 146px + 5 * 16px + 20px);
      }
    }

    /* The frame: wood/black options, matting, bevel */
    /* The frame: wood/black options, matting, bevel */
    .wallFrame {
      position: relative;
      border-radius: 2px;
      /* Nearly square */
      cursor: pointer;
      transform: rotate(var(--rot, 0deg)) translateZ(0);
      transition: transform .22s ease, box-shadow .22s ease;
      box-shadow:
        0 12px 24px rgba(0, 0, 0, .20),
        0 4px 8px rgba(0, 0, 0, .15);
    }

    /* "Frame" layer (outer) */
    .wallFrame::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 2px;
      /* Dark frame against light wall */
      background: var(--frameFill, linear-gradient(135deg, #222, #111));
      box-shadow:
        inset 0 0 0 1px rgba(255, 255, 255, 0.1),
        inset 2px 2px 2px rgba(0, 0, 0, 0.5);
    }

    /* "Mat" layer (inner) */
    .wallFrame::after {
      content: "";
      position: absolute;
      inset: 12px;
      border-radius: 1px;
      background: #fdfbf7;
      /* Very clean white mat */
      box-shadow:
        inset 0 1px 3px rgba(0, 0, 0, .15);
    }

    /* Inner content window */
    .wallWindow {
      position: relative;
      z-index: 2;
      margin: 20px;
      /* Adjusted margin for better fit */
      border-radius: 0;
      overflow: hidden;
      background: #fff;
      box-shadow: inset 0 0 2px rgba(0, 0, 0, 0.1);
      aspect-ratio: 3 / 4;
      /* Maintain BeReal aspect ratio */
      height: calc(100% - 60px);
      /* Make window shorter than frame to show mat at top/bottom */
      width: auto;
    }

    /* Image fit */
    .wallWindow img.back {
      width: 100%;
      height: 100%;
      display: block;
      object-fit: cover;
      /* CHANGED from cover to cover (already cover, but ratio matches now) */
    }

    /* little "BeReal front" inside the same framed piece */
    .wallWindow img.front {
      position: absolute;
      right: 8px;
      bottom: 8px;
      width: 26%;
      aspect-ratio: 3/4;
      object-fit: cover;
      border-radius: 1px;
      border: 2px solid #fff;
      box-shadow: 0 4px 8px rgba(0, 0, 0, .25);
      background: #eee;
    }

    /* Hover feel */
    .wallFrame:hover {
      transform: rotate(var(--rot, 0deg)) translateY(-2px);
      box-shadow:
        0 30px 90px rgba(0, 0, 0, .45),
        0 12px 28px rgba(0, 0, 0, .30);
    }

    /* Placard (gallery label) */
    .wallPlacard {
      margin-top: 8px;
      padding: 8px 10px;
      color: rgba(255, 255, 255, .92);
      font-size: 12px;
      letter-spacing: .2px;
      display: flex;
      flex-direction: column;
      gap: 2px;
      opacity: .92;
    }

    .wallPlacard .cap {
      font-weight: 650;
    }

    .wallPlacard .date {
      opacity: .75;
      font-size: 12px;
    }

    .wallWindow {
      position: relative;
      z-index: 2;
      margin: 16px;
      /* ‚Üì was too thick */
      border-radius: 10px;
      overflow: hidden;
      background: #000;
    }

    .wallSize-hero .wallWindow {
      margin: 12px;
    }

    /* Hover feel */
    .wallFrame:hover {
      transform: rotate(var(--rot, 0deg)) scale(1.02);
      z-index: 10;
      box-shadow:
        0 20px 50px rgba(0, 0, 0, .25),
        0 8px 16px rgba(0, 0, 0, .15);
    }

    .wallPlacard {
      margin-top: 8px;
      padding: 4px 6px;
      color: #333;
      /* Dark text for light wall */
      font-size: 11px;
      letter-spacing: .2px;
      text-transform: uppercase;
      font-weight: 600;
      background: rgba(255, 255, 255, 0.7);
      display: inline-block;
      border-radius: 2px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    .wallPlacard .date {
      font-weight: 400;
      color: #666;
      display: block;
      font-size: 10px;
    }

    .wallSize-hero .wallWindow {
      margin: 32px;
      /* larger mat for hero */
    }

    /* Reduce motion option */
    .wallReduceMotion .wallFrame {
      transform: none !important;
      transition: none !important;
    }

    .wallReduceMotion .wallFrame:hover {
      transform: none !important;
    }

    /* Stats View */
    .statsGrid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      padding-bottom: 40px;
    }

    .statCard {
      background: #fff;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      border: 1px solid #eee;
      display: flex;
      flex-direction: column;
      /* align-items: center; text-align: center; */
    }

    .statCard h3 {
      margin: 0 0 16px 0;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #888;
      font-weight: 600;
    }

    .statBig {
      font-size: 36px;
      font-weight: 700;
      color: #1a1a1a;
      line-height: 1.1;
      margin-bottom: 4px;
    }

    .statSub {
      font-size: 14px;
      color: #666;
    }

    .statList {
      list-style: none;
      padding: 0;
      margin: 0;
      width: 100%;
    }

    .statList li {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #f5f5f5;
      font-size: 14px;
    }

    .statList li:last-child {
      border-bottom: none;
    }

    .statChartBar {
      height: 6px;
      background: #eee;
      border-radius: 3px;
      margin-top: 6px;
      overflow: hidden;
    }

    .statChartFill {
      height: 100%;
      background: #111;
      border-radius: 3px;
    }

    /* View Transitions */
    ::view-transition-old(root),
    ::view-transition-new(root) {
      animation-duration: 0.4s;
    }

    /* Custom slide-fade for views */
    .view {
      view-transition-name: museum-view;
    }

    @keyframes slide-from-right {
      from {
        transform: translateX(30px);
        opacity: 0;
      }
    }

    @keyframes slide-to-left {
      to {
        transform: translateX(-30px);
        opacity: 0;
      }
    }

    ::view-transition-old(museum-view) {
      animation: 0.4s ease both slide-to-left;
    }

    ::view-transition-new(museum-view) {
      animation: 0.4s ease both slide-from-right;
    }

    @media print {
      @page {
        margin: 0;
        size: auto;
      }

      body {
        background: #fff !important;
        margin: 0 !important;
        padding: 0 !important;
      }

      header,
      nav,
      .tabs,
      .bookControls,
      #bookSidebar,
      .tabHost,
      section,
      footer,
      .hint,
      #chartTooltip {
        display: none !important;
      }

      #printContainer {
        display: block !important;
        width: 100% !important;
        margin: 0 !important;
        padding: 0 !important;
      }

      .bookPage,
      .titlePage {
        width: 100% !important;
        height: 100vh !important;
        page-break-after: always !important;
        break-after: page !important;
        display: flex !important;
        flex-direction: column !important;
        justify-content: center !important;
        align-items: center !important;
        padding: 40px !important;
        box-sizing: border-box !important;
        border: none !important;
        position: relative !important;
        background: #fff !important;
        color: #000 !important;
      }

      .titlePage {
        background: #000 !important;
        color: #fff !important;
      }

      .bookGrid {
        display: grid !important;
        grid-template-columns: 1fr 1fr !important;
        gap: 40px !important;
        width: 100% !important;
      }

      .bookPhoto {
        break-inside: avoid !important;
      }

      .bookPhoto .frame {
        height: 380px !important;
      }

      .dividerPage h2 {
        font-size: 48px !important;
      }

      img {
        max-width: 100% !important;
        print-color-adjust: exact !important;
        -webkit-print-color-adjust: exact !important;
      }
    }

    #printContainer {
      display: none;
    }

    /* Museum Entrance Landing */
    #entrance {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at center, #222 0%, #000 100%);
      z-index: 10000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #fff;
      transition: opacity 0.8s ease, visibility 0.8s;
      text-align: center;
      padding: 40px;
    }

    #entrance.hidden {
      opacity: 0;
      visibility: hidden;
    }

    .entranceFrame {
      border: 2px solid #c5a059;
      /* Gold border */
      padding: 60px;
      border-radius: 4px;
      position: relative;
      background: rgba(0, 0, 0, 0.4);
      box-shadow: 0 0 100px rgba(197, 160, 89, 0.1);
      max-width: 600px;
      width: 100%;
    }

    .entranceFrame::before,
    .entranceFrame::after {
      content: "";
      position: absolute;
      width: 40px;
      height: 40px;
      border: 2px solid #c5a059;
    }

    .entranceFrame::before {
      top: -10px;
      left: -10px;
      border-right: 0;
      border-bottom: 0;
    }

    .entranceFrame::after {
      bottom: -10px;
      right: -10px;
      border-left: 0;
      border-top: 0;
    }

    /* Decorative Columns */
    .portalColumn {
      position: absolute;
      top: 10%;
      bottom: 10%;
      width: 1px;
      background: linear-gradient(to bottom, transparent, #c5a059, transparent);
      opacity: 0.3;
    }

    .portalColumn.left {
      left: 40px;
    }

    .portalColumn.right {
      right: 40px;
    }

    #entrance h1 {
      font-size: 56px;
      font-weight: 300;
      letter-spacing: 12px;
      text-transform: uppercase;
      margin: 0 0 10px;
      color: #fff;
      text-shadow: 0 0 20px rgba(197, 160, 89, 0.5);
    }

    #entrance p {
      font-size: 14px;
      opacity: 0.6;
      letter-spacing: 2px;
      margin-bottom: 40px;
    }

    .museumTicket {
      display: inline-block;
      background: #c5a059;
      color: #000;
      padding: 16px 40px;
      border-radius: 2px;
      font-weight: 700;
      letter-spacing: 2px;
      text-transform: uppercase;
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .museumTicket:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 10px 30px rgba(197, 160, 89, 0.4);
    }

    .museumTicket::after {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 50%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
      transition: left 0.5s ease;
    }

    .museumTicket:hover::after {
      left: 150%;
    }

    .ticketStub {
      position: absolute;
      width: 20px;
      height: 20px;
      background: #000;
      border-radius: 50%;
      top: 50%;
      transform: translateY(-50%);
    }

    .ticketStub.left {
      left: -10px;
    }

    .ticketStub.right {
      right: -10px;
    }

    header {
      padding: 12px 20px;
      background: #000;
      color: #fff;
      border-bottom: 1px solid #333;
      display: none;
      /* Initially hide the small header */
    }

    header.active {
      display: flex;
      border-bottom: 2px solid var(--accent);
      box-shadow: 0 10px 40px rgba(197, 160, 89, 0.1);
    }

    /* Refined Gallery Tabs */
    .tabs {
      background: #111;
      padding: 10px;
      border-radius: 4px;
      border: 1px solid #222;
      box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
    }

    .tab {
      border: none;
      background: transparent;
      letter-spacing: 2px;
      text-transform: uppercase;
      font-size: 11px;
    }

    .tab.active {
      background: var(--accent);
      color: #000;
      border-radius: 2px;
    }

    /* Exhibit Cards */
    .statCard,
    .tile,
    .eraCard,
    .mosaicControls,
    .wallToolbar {
      border: 1px solid #222 !important;
      background: #141414 !important;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4) !important;
      position: relative;
    }

    .statCard h3 {
      color: var(--accent) !important;
      letter-spacing: 2px;
    }

    .statBig {
      color: #fff !important;
    }

    .btn {
      border-radius: 2px !important;
      text-transform: uppercase;
      font-size: 11px;
      letter-spacing: 1px;
      font-weight: 700;
    }

    /* Gallery Frame Enhancement */
    .view {
      animation: fadeIn 0.4s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Timeline & Favorites Grid */
    #timelineGrid,
    #favoritesGrid {
      gap: 20px !important;
    }

    .tile {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .tile:hover {
      transform: translateY(-4px);
      box-shadow: 0 30px 60px rgba(197, 160, 89, 0.2) !important;
    }

    /* Museum Wall Enhancements */
    .museumWall {
      background: #0a0a0a !important;
    }

    /* Book Preview */
    .bookPage {
      background: #fafaf8 !important;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8) !important;
    }

    /* Story Modal */
    #storyModal,
    #reelModal {
      background: rgba(0, 0, 0, 0.95) !important;
    }

    /* Input & Select Styling */
    input,
    select,
    textarea {
      background: #1a1a1a !important;
      border: 1px solid #333 !important;
      color: #f0f0f0 !important;
      border-radius: 2px !important;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--accent) !important;
      outline: none;
    }

    /* Scrollbar Styling */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #0a0a0a;
    }

    ::-webkit-scrollbar-thumb {
      background: #333;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--accent);
    }

    /* Privacy Badge */
    .privacyBadge {
      margin-top: 40px;
      padding: 20px;
      background: rgba(197, 160, 89, 0.05);
      border: 1px solid rgba(197, 160, 89, 0.2);
      border-radius: 4px;
      font-size: 11px;
      line-height: 1.6;
      color: #ccc;
    }

    .privacyBadge strong {
      color: var(--accent);
      display: block;
      margin-bottom: 8px;
      font-size: 12px;
      letter-spacing: 1px;
    }

    .privacyBadge a {
      color: var(--accent);
      text-decoration: none;
      border-bottom: 1px solid transparent;
      transition: border-color 0.2s;
    }

    .privacyBadge a:hover {
      border-bottom-color: var(--accent);
    }

    .privacyIcon {
      display: inline-block;
      margin-right: 6px;
      font-size: 14px;
    }

    /* Footer */
    footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 12px 20px;
      background: #000;
      border-top: 1px solid #222;
      text-align: center;
      font-size: 11px;
      color: #666;
      z-index: 200;
      display: none;
    }

    footer.active {
      display: block;
    }

    footer a {
      color: var(--accent);
      text-decoration: none;
      margin: 0 12px;
    }

    footer a:hover {
      text-decoration: underline;
    }

    /* Manager Modal - Force Light Theme */
    .managerBox {
      color: #1a1a1a !important;
    }

    .managerBox h2,
    .managerBox span,
    .managerBox label,
    .managerBox button {
      color: #1a1a1a !important;
    }

    .managerBox .btn {
      background: #fff !important;
      border: 1px solid #ddd !important;
      color: #1a1a1a !important;
    }

    .managerBox .btn:hover {
      background: #f5f5f5 !important;
    }

    .managerBox input[type="checkbox"] {
      accent-color: #000;
    }
  </style>
</head>

<body>
  <div id="entrance">
    <div class="portalColumn left"></div>
    <div class="portalColumn right"></div>
    <div class="entranceFrame">
      <h1>The BeReal Museum</h1>
      <p>EST. 2025 ‚Ä¢ YOUR MEMORIES CURATED</p>

      <label for="file" class="museumTicket">
        <div class="ticketStub left"></div>
        Import ZIP file
        <div class="ticketStub right"></div>
      </label>

      <input id="file" type="file" accept=".zip" style="display:none;" />

      <div id="entranceStatus" style="margin-top: 30px; font-size: 12px; opacity: 0.5; letter-spacing: 1px;">
        UPLOAD BEREAL EXPORT ZIP
      </div>

      <div class="privacyBadge">
        <strong><span class="privacyIcon">üîí</span>Privacy First</strong>
        Your data never leaves your computer. All processing happens locally in your browser.
        <a href="privacy.html" target="_blank">Read our Privacy Policy ‚Üí</a>
      </div>
    </div>
  </div>

  <header id="mainHeader">
    <h1 style="letter-spacing: 2px; font-weight: 400;">THE BEREAL MUSEUM</h1>
    <span class="muted" id="status" style="margin-left: auto;"></span>
  </header>

  <main>
    <div class="tabs">
      <button class="tab" id="tab-timeline" data-view="timeline">Timeline</button>
      <button class="tab" id="tab-favorites" data-view="favorites">Favorites</button>
      <button class="tab" id="tab-mosaic" data-view="mosaic">Mosaic</button>
      <button class="tab" id="tab-stats" data-view="stats">Stats</button>
      <button class="tab" id="tab-worldtour" data-view="worldtour">World Tour</button>
      <button class="tab" id="tab-realmojiwall" data-view="realmojiwall">Realmoji Wall</button>
    </div>

    <!-- Timeline -->
    <section id="view-timeline">
      <div class="row" style="margin: 8px 0 10px;">
        <button class="btn" id="tlModeGrid" disabled>Grid</button>
        <button class="btn" id="tlModeStrip" disabled>Strip</button>
        <button class="btn" id="tlModeOnThisDay" disabled>On this day</button>
        <button class="btn" id="tlModeManager" disabled>‚ö° Manager</button>

        <span style="flex:1"></span>

        <button class="btn" id="sortAsc" disabled>Sort: Old ‚Üí New</button>
        <button class="btn" id="sortDesc" disabled>Sort: New ‚Üí Old</button>

        <button class="btn" id="exportNotes" disabled>Export notes</button>
        <label class="btn" style="display:inline-block">
          Import notes
          <input id="importNotes" type="file" accept="application/json" style="display:none" />
        </label>

        <span class="muted" id="count"></span>
      </div>

      <div class="row" id="tlOnThisDayControls" style="display:none; margin: 0 0 12px;">
        <select id="tlMonthPick" class="btn">
          <option value="1">Jan</option>
          <option value="2">Feb</option>
          <option value="3">Mar</option>
          <option value="4">Apr</option>
          <option value="5">May</option>
          <option value="6">Jun</option>
          <option value="7">Jul</option>
          <option value="8">Aug</option>
          <option value="9">Sep</option>
          <option value="10">Oct</option>
          <option value="11">Nov</option>
          <option value="12">Dec</option>
        </select>
        <select id="tlDayPick" class="btn"></select>
        <span class="hint">Shows posts taken on that month/day (across all years).</span>
      </div>

      <div id="timelineGrid"></div>
      <div id="timelineStrip" style="display:none"></div>
    </section>

    <!-- Favorites -->
    <section id="view-favorites" style="display:none">
      <div class="row" style="margin: 8px 0 10px;">
        <button class="btn" id="favModeGrid" disabled>Grid</button>
        <button class="btn" id="favModeStrip" disabled>Strip</button>
        <button class="btn" id="favModeStory" disabled>Story</button>
        <button class="btn" id="favModeRoulette" disabled>Roulette</button>
        <button class="btn" id="favModeOnThisDay" disabled>On this day</button>

        <!-- NEW -->
        <button class="btn" id="favModeReel" disabled>Highlight Reel</button>
        <button class="btn" id="favModeWall" disabled>Museum Wall</button>
        <button class="btn" id="favModeBook" disabled>Book Preview</button>
        <button class="btn" id="favModeEras" disabled>Eras</button>

        <button class="btn" id="exportFavorites" disabled>Export favorites</button>

        <span style="flex:1"></span>

        <select id="labelFilter" class="btn" disabled>
          <option value="">All labels</option>
        </select>

        <input id="labelSearch" placeholder="Search labels/text‚Ä¶"
          style="padding:8px 10px;border:1px solid #ddd;border-radius:10px;font-size:13px;min-width:220px" disabled />

        <span class="muted" id="favCount"></span>
      </div>

      <div class="row" id="onThisDayControls" style="display:none; margin: 0 0 12px;">
        <select id="monthPick" class="btn">
          <option value="1">Jan</option>
          <option value="2">Feb</option>
          <option value="3">Mar</option>
          <option value="4">Apr</option>
          <option value="5">May</option>
          <option value="6">Jun</option>
          <option value="7">Jul</option>
          <option value="8">Aug</option>
          <option value="9">Sep</option>
          <option value="10">Oct</option>
          <option value="11">Nov</option>
          <option value="12">Dec</option>
        </select>
        <select id="dayPick" class="btn"></select>
        <span class="hint">Shows favorites taken on that month/day (across all years).</span>
      </div>

      <!-- Grid -->
      <div id="favoritesGrid"
        style="display:grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 12px;"></div>

      <!-- Strip -->
      <div id="favoritesStrip" style="display:none"></div>

      <!-- Roulette -->
      <div id="rouletteWrap" style="display:none">
        <div class="row" style="margin: 0 0 12px;">
          <button class="btn" id="rouletteSpin" disabled>Spin üé∞</button>
          <span class="hint">Rapid shuffle ‚Üí slow down ‚Üí lands on a favorite.</span>
        </div>
        <div id="rouletteStage"></div>
      </div>

      <!-- NEW: Museum Wall -->
      <div id="museumWallWrap">
        <div class="row wallToolbar">
          <button class="btn" id="wallRegenerate">Regenerate layout</button>
          <label class="btn" style="display:inline-flex; gap:8px; align-items:center;">
            <input id="wallReduceMotion" type="checkbox" />
            Reduce motion
          </label>
          <span class="hint">Click a frame to open Story view.</span>
        </div>
        <div id="museumWall" class="museumWall"></div>
      </div>

      <!-- NEW: Book Preview -->
      <div id="bookWrap">
        <div id="bookSidebar"></div>
        <div id="bookMain">
          <div class="bookControls">
            <button class="btn" id="bookPrev">‚Üê Prev page</button>
            <button class="btn" id="bookNext">Next page ‚Üí</button>
            <span class="muted" id="bookPageInfo"></span>
            <span style="flex:1"></span>
            <button class="btn" id="bookPrint">Print / Save as PDF</button>
            <span class="hint">Tip: Use your browser‚Äôs ‚ÄúSave as PDF‚Äù.</span>
          </div>
          <div id="bookPageHost"></div>
        </div>
      </div>

      <!-- NEW: Eras -->
      <div id="eraWrap">
        <div class="eraTwoCol">
          <div class="eraCard">
            <h3>Manage Eras</h3>
            <div class="muted">Eras are stored in localStorage under <code>bereal_eras</code>.</div>
            <div class="row" style="margin-top:10px;">
              <input id="eraName" class="btn" style="flex:1; min-width: 220px;"
                placeholder="Era name (e.g., College)" />
              <input id="eraStart" class="btn" type="date" />
              <input id="eraEnd" class="btn" type="date" />
              <button class="btn" id="eraAdd">Add</button>
            </div>
            <div id="eraWarnings" class="eraWarn" style="margin-top:10px;"></div>
            <div id="eraList"></div>
          </div>

          <div class="eraCard">
            <div class="row" style="justify-content: space-between;">
              <div>
                <h3 style="margin:0;">Era Gallery</h3>
                <div class="muted" id="eraGalleryHint">Click an era to browse favorites in it.</div>
              </div>
              <label class="btn" style="display:inline-flex; gap:8px; align-items:center;">
                <input id="eraFilterAffects" type="checkbox" checked />
                Filters affect eras
              </label>
            </div>
            <div id="eraGallery" style="margin-top:10px;"></div>
            <div id="eraBrowse" style="margin-top:10px; display:none;">
              <div class="row" style="margin:0 0 10px;">
                <button class="btn" id="eraBack">‚Üê Back to eras</button>
                <span class="muted" id="eraBrowseTitle"></span>
              </div>
              <div id="eraBrowseGrid"
                style="display:grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 12px;"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Stats -->
    <section id="view-stats" style="display:none">
      <div class="statsGrid">

        <!-- Hero Stats -->
        <div class="statCard" style="grid-column: span 2;">
          <h3>Your Journey</h3>
          <div style="display:flex; gap:32px; flex-wrap:wrap;">
            <div>
              <div class="statBig" id="stStartDay">-</div>
              <div class="statSub">First Post</div>
            </div>
            <div>
              <div class="statBig" id="stDuration">-</div>
              <div class="statSub">Time on BeReal</div>
            </div>
            <div>
              <div class="statBig" id="stTotal">-</div>
              <div class="statSub">Total Memories</div>
            </div>
          </div>
        </div>

        <!-- Streak -->
        <div class="statCard">
          <h3>Longest Streak</h3>
          <div class="statBig" id="stStreak">-</div>
          <div id="stStreakDates" style="font-size:12px; color:#666; font-style:italic; margin-bottom:12px;"></div>

          <div style="border-top:1px solid #eee; padding-top:12px; margin-top:12px;">
            <div class="statSub">Longest Dry Spell</div>
            <div class="statBig" style="font-size:20px;" id="stDrySpell">-</div>
            <div id="stDrySpellDates" style="font-size:12px; color:#666; font-style:italic;"></div>
          </div>
        </div>

        <!-- Consistency -->
        <div class="statCard">
          <h3>Consistency</h3>
          <div class="statBig" id="stPercent">-</div>
          <div class="statSub">Of days since start</div>
          <div style="margin-top:12px; font-size:13px; color:#555;">
            Multiple Posts: <strong id="stMulti">-</strong> days
          </div>
          <div style="margin-top:16px;">
            <canvas id="chartConsistency" style="width:100%; height:150px;"></canvas>
          </div>
        </div>

        <!-- Punctuality -->
        <div class="statCard" style="grid-column: span 1;">
          <h3>Punctuality</h3>
          <div class="statBig" id="stOnTime">-</div>
          <div class="statSub">On Time Percentage</div>

          <div style="margin-top:16px; border-top:1px solid #eee; padding-top: 12px;">
            <ul class="statList" style="margin-top:12px;">
              <li><span>Most Punctual</span> <strong id="stPrimeTime">-</strong></li>
              <li><span>Toughest Hour</span> <strong id="stToughTime">-</strong></li>
              <li><span>Median Reaction</span> <strong id="stAvgReaction">-</strong></li>
              <li><span>Personal Best</span> <strong id="stFastestReaction">-</strong></li>
            </ul>
            <div style="margin-top:12px; font-size:12px; color:#888;">On-Time % vs Notification Hour</div>
            <canvas id="chartPunctuality" style="width:100%; height:140px; margin-top:8px;"></canvas>
          </div>

          <div style="margin-top:16px; font-size:12px; color:#aaa; border-top:1px solid #fafafa; padding-top:8px;">
            On Time / Total Days: <strong id="stMemoryCount">-</strong>
          </div>
        </div>

        <!-- Top Day -->
        <div class="statCard">
          <h3>Busiest Day</h3>
          <div class="statBig" id="stBusyCount">-</div>
          <div class="statSub" id="stBusyDate">-</div>
          <button class="btn" id="stBusyBtn" style="margin-top:12px; align-self:start;">View Posts</button>
        </div>

        <!-- Day of Week Analysis -->
        <div class="statCard">
          <h3>Weekly Habits</h3>
          <ul class="statList" style="margin-bottom:16px;">
            <li><span>Most Consistent</span> <strong id="stWeekMost">-</strong></li>
            <li><span>Least Consistent</span> <strong id="stWeekLeast">-</strong></li>
          </ul>
          <canvas id="chartWeekly" style="width:100%; height:160px;"></canvas>
        </div>

        <!-- Month Analysis -->
        <div class="statCard">
          <h3>Month Analysis</h3>
          <ul class="statList" style="margin-bottom:12px;">
            <li><span>Most Active</span> <strong id="stMonthMost">-</strong></li>
            <li><span>Least Active</span> <strong id="stMonthLeast">-</strong></li>
          </ul>
          <div style="margin-top:12px; font-size:12px; color:#888;">Monthly Activity Intensity</div>
          <canvas id="chartMonthHeatmap" style="width:100%; height:100px; margin-top:8px;"></canvas>
        </div>

        <!-- BeReal Moment Times -->
        <div class="statCard" style="grid-column: span 2;">
          <h3>‚è∞ BeReal Moment Times</h3>
          <div style="display:flex; gap:32px; flex-wrap:wrap; margin-bottom:20px;">
            <div>
              <div class="statSub">Earliest Moment</div>
              <div class="statBig" style="font-size:24px;" id="stMomentEarliest">-</div>
            </div>
            <div>
              <div class="statSub">Latest Moment</div>
              <div class="statBig" style="font-size:24px;" id="stMomentLatest">-</div>
            </div>
            <div>
              <div class="statSub">Most Common Hour</div>
              <div class="statBig" style="font-size:24px;" id="stMomentCommon">-</div>
            </div>
          </div>
          <div style="margin-top:12px; font-size:12px; color:#888;">24-Hour Distribution</div>
          <canvas id="chartMomentTimes" style="width:100%; height:180px; margin-top:8px;"></canvas>
        </div>

        <!-- Time Machine -->
        <div class="statCard" style="grid-column: span 2;">
          <h3>Time Machine</h3>
          <div style="display:flex; gap:32px; flex-wrap:wrap; align-items:center; margin-bottom:20px;">
            <div>
              <div class="statSub">Earliest Post</div>
              <div class="statBig" style="font-size:24px;" id="stTimeEarly">-</div>
            </div>
            <div>
              <div class="statSub">Latest Post</div>
              <div class="statBig" style="font-size:24px;" id="stTimeLate">-</div>
            </div>
            <div>
              <div class="statSub">Peak Hour</div>
              <div class="statBig" style="font-size:24px;" id="stTimePeak">-</div>
            </div>
          </div>
          <canvas id="chartScatter"
            style="width:100%; height:280px; background:#fafafa; border-radius:12px; border:1px solid #eee;"></canvas>
          <div id="chartTooltip">
            <img id="ttImg" src="" alt="" style="display:none;">
            <div id="ttInfo">
              <div class="ttDate" id="ttDate"></div>
              <div class="ttTime" id="ttTime"></div>
            </div>
            <div id="ttGeneric" style="display:none;">
              <div class="ttLabel" id="ttLabel"></div>
              <div class="ttSub" id="ttSub"></div>
            </div>
          </div>
        </div>

        <!-- NEW: Retakes -->
        <div class="statCard">
          <h3>Retake King/Queen</h3>
          <div class="statBig" id="stRetakeTotal">-</div>
          <div class="statSub">Total Retakes</div>
          <div style="margin-top:12px; font-size:13px; color:#555;">
            Max on one post: <strong id="stRetakeMax">-</strong>
          </div>
          <div style="font-size:13px; color:#555;">
            Avg/Post: <strong id="stRetakeAvg">-</strong>
          </div>
        </div>

        <!-- Social Circle -->
        <div class="statCard">
          <h3>Social Circle</h3>
          <div class="statBig" id="stFriendCount">-</div>
          <div class="statSub">Total Friends</div>
          <ul class="statList" style="margin-top:16px;">
            <li><span>Oldest (BFF)</span> <strong id="stFriendOldest">-</strong></li>
            <li style="font-size:11px; color:#888; margin-bottom:8px;"><span id="stFriendOldestDate"></span></li>

            <li><span>Newest Friend</span> <strong id="stFriendNewest">-</strong></li>
            <li style="font-size:11px; color:#888; margin-bottom:8px;"><span id="stFriendNewestDate"></span></li>

            <li><span>Added This Year</span> <strong id="stFriendYear">-</strong></li>
            <li><span>Growth Velocity</span> <strong id="stFriendVelocity">-</strong></li>
          </ul>
        </div>

        <!-- NEW: Social Activity -->
        <div class="statCard">
          <h3>Social Activity</h3>
          <div class="statBig" id="stCommentCount">-</div>
          <div class="statSub">Total Comments</div>
          <div style="margin-top:12px; font-size:13px; color:#555;">
            Unique Realmojis: <strong id="stRealmojiCount">-</strong>
          </div>
        </div>

        <!-- NEW: Locations & Night Owl -->
        <div class="statCard">
          <h3>Habits & Travels</h3>
          <ul class="statList">
            <li><span>Unique Locations</span> <strong id="stLocCount">-</strong></li>
            <li><span>Night Owl Posts</span> <strong id="stNightOwl">-</strong></li>
          </ul>
          <div class="statSub" style="margin-top:8px;">(10PM - 4AM local)</div>
        </div>

      </div>
    </section>

    <!-- Section 6: World Tour -->
    <section id="viewWorldTour" style="display:none">
      <div id="map" style="width: 100%; height: calc(100vh - 120px); border-radius: 12px; background: #f0f0f0;"></div>
    </section>

    <!-- Section 7: Realmoji Wall -->
    <section id="viewRealmojiWall" style="display:none">
      <div id="realmojiWall" class="realmojiWall"></div>
    </section>

    <!-- RealMoji Lightbox Modal -->
    <div id="realmojiModal">
      <div class="closeBtn">√ó</div>
      <img id="realmojiModalImg" src="" alt="RealMoji">
    </div>

    <!-- Story modal -->
    <div id="storyModal">
      <div class="storyBox" id="storyBox">
        <div class="storyTop">
          <div>
            <div class="storyLabel" id="storyLabel"></div>
            <div class="storyMeta" id="storyMeta"></div>
          </div>
          <div class="row">
            <button class="storyBtn" id="storyPrev">‚Üê</button>
            <button class="storyBtn" id="storyNext">‚Üí</button>
            <button class="storyBtn" id="storyClose">‚úï</button>
          </div>
        </div>

        <img class="back" id="storyBack" />
        <img class="front" id="storyFront" />

        <!-- click left/right to navigate -->
        <div class="storyNav">
          <div id="storyNavLeft" title="Previous"></div>
          <div id="storyNavRight" title="Next"></div>
        </div>
      </div>
    </div>

    <!-- NEW: Highlight Reel modal -->
    <div id="reelModal">
      <div class="reelBox">
        <div class="reelTop">
          <div class="row" style="gap:8px;">
            <button class="storyBtn" id="reelPrev">‚Üê</button>
            <button class="storyBtn" id="reelPlay">‚è∏</button>
            <button class="storyBtn" id="reelNext">‚Üí</button>
            <select class="storyBtn" id="reelSpeed">
              <option value="2000">2s</option>
              <option value="1000">Fast (1s)</option>
              <option value="500">Speedrun (0.5s)</option>
              <option value="3000" selected>3s</option>
              <option value="4000">4s</option>
            </select>
            <button id="reelRecord" class="btn" title="Download Video">‚¨áÔ∏è üé•</button>
            <label class="storyBtn" style="display:inline-flex; gap:8px; align-items:center;">
              <input id="reelShowLabels" type="checkbox" checked />
              Labels
            </label>
            <label class="storyBtn" style="display:inline-flex; gap:8px; align-items:center;">
              <input id="reelMusic" type="checkbox" />
              Music
            </label>
            <label class="storyBtn" style="display:inline-flex; gap:8px; align-items:center;">
              Custom Audio
              <input id="reelAudioFile" type="file" accept="audio/*" style="display:none" />
            </label>
          </div>
          <button class="storyBtn" id="reelClose">‚úï</button>
        </div>

        <div class="reelMedia">
          <img class="back" id="reelBack" />
          <img class="front" id="reelFront" />
        </div>

        <div class="reelBottom">
          <div class="reelLabel" id="reelLabel"></div>
          <div class="reelMeta" id="reelMeta"></div>
        </div>
      </div>
    </div>

    <!-- Mosaic -->
    <section id="view-mosaic" style="display:none">
      <div class="row" style="margin: 8px 0 14px;">
        <button class="btn" id="buildMosaic" disabled>Build mosaic</button>
        <button class="btn" id="shuffleMosaic" disabled>Shuffle</button>
        <label class="btn" style="display:inline-flex; gap:8px; align-items:center;">
          Target Image
          <input id="mosaicTarget" type="file" accept="image/*" style="display:none" />
        </label> <span class="muted">Scroll to zoom ‚Ä¢ Drag to pan</span>
      </div>
      <div id="mosaicWrap">
        <canvas id="mosaic"></canvas>
      </div>
    </section>

    <!-- NEW: Bulk Manager Modal -->
    <div id="favManagerModal"
      style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.85); z-index:11000; align-items:center; justify-content:center; padding:18px;">
      <div class="managerBox"
        style="background:#fff; width:min(600px, 100%); max-height:90vh; border-radius:18px; overflow-y:auto; display:flex; flex-direction:column; box-shadow: 0 20px 60px rgba(0,0,0,0.5);">

        <div
          style="padding:16px 20px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center; position:sticky; top:0; background:#fff; z-index:10;">
          <h2 style="margin:0; font-size:18px; font-weight:600;">Bulk Favorite Manager</h2>
          <button class="btn" id="mgrClose" style="border:none; font-size:18px; padding:4px 8px;">‚úï</button>
        </div>

        <div style="padding:20px; display:flex; flex-direction:column; gap:24px;">

          <!-- Days Filter -->
          <div>
            <div class="row" style="margin-bottom:12px; justify-content:space-between;">
              <span style="font-weight:600">Days of Week</span>
              <label class="btn" style="padding:4px 8px; font-size:12px;"><input type="checkbox" id="mgrDayAll" checked>
                Select All</label>
            </div>
            <div class="mgrGrid" id="mgrDaysGrid"
              style="display:grid; grid-template-columns:repeat(auto-fit, minmax(80px, 1fr)); gap:8px;">
              <!-- Populated by JS -->
            </div>
          </div>

          <!-- Months Filter -->
          <div>
            <div class="row" style="margin-bottom:12px; justify-content:space-between;">
              <span style="font-weight:600">Months</span>
              <label class="btn" style="padding:4px 8px; font-size:12px;"><input type="checkbox" id="mgrMonthAll"
                  checked> Select All</label>
            </div>
            <div class="mgrGrid" id="mgrMonthsGrid"
              style="display:grid; grid-template-columns:repeat(auto-fit, minmax(60px, 1fr)); gap:8px;">
              <!-- Populated by JS -->
            </div>
          </div>

          <!-- Time Filter -->
          <div style="background:#fafafa; padding:16px; border-radius:12px;">
            <div class="row" style="margin-bottom:12px; font-weight:600; justify-content:space-between;">
              <span>Time Range</span>
              <label class="btn"
                style="padding:4px 8px; font-size:12px; display:inline-flex; gap:6px; align-items:center;">
                <input type="checkbox" id="mgrTimeInvert"> Invert (Exclude)
              </label>
            </div>
            <div class="row" style="gap:10px;">
              <input type="time" id="mgrTimeStart" class="btn" value="09:00" style="flex:1">
              <span style="color:#666">to</span>
              <input type="time" id="mgrTimeEnd" class="btn" value="17:00" style="flex:1">
            </div>
            <div class="row" style="margin-top:12px;">
              <button class="btn" style="font-size:12px; width:100%; text-align:center;" id="mgrPresetWork">Preset:
                Exclude Work (M-F 9-5)</button>
            </div>
          </div>

          <!-- Preview Grid -->
          <div id="mgrPreviewContainer" style="display:none; border-top:1px solid #eee; padding-top:16px;">
            <div class="row" style="margin-bottom:12px; font-weight:600; justify-content:space-between;">
              <span>Preview Matches <span id="mgrPreviewCount"
                  style="font-weight:400; color:#666; font-size:13px;"></span></span>
              <button class="btn" style="padding:4px 10px; font-size:12px;" id="mgrSelectAllPreview">Select All</button>
            </div>
            <div style="font-size:12px; color:#666; margin-bottom:10px;">Click photos to <b>exclude</b> them from the
              action.</div>
            <div id="mgrPreviewGrid"
              style="display:grid; grid-template-columns:repeat(auto-fill, minmax(90px, 1fr)); gap:10px; max-height:300px; overflow-y:auto; padding:4px;">
              <!-- Populated by JS -->
            </div>
          </div>

          <!-- Stats & Actions -->
          <div
            style="background:#f0f0f0; padding:16px; border-radius:12px; border:1px solid #ddd; position:sticky; bottom:0;">
            <div style="margin-bottom:12px; display:flex; justify-content:space-between; align-items:center;">
              <span id="mgrStats" style="font-weight:600; color:#333;">Matches: 0 posts</span>
              <button class="btn" id="mgrShowPreview" style="font-size:12px;">üëÅÔ∏è Preview / Edit</button>
            </div>
            <div class="row" style="gap:12px;">
              <button class="btn" id="mgrActionFav"
                style="flex:1; background:#111; color:#fff; border-color:#111;--radius-btn:12px;">‚òÖ Favorite
                Matches</button>
              <button class="btn" id="mgrActionUnfav" style="flex:1; --radius-btn:12px;">‚òÜ Unfavorite Matches</button>
            </div>
          </div>

        </div>
      </div>
    </div>

  </main>

  <div id="printContainer"></div>

  <script src="https://cdn.jsdelivr.net/npm/fflate@0.8.2/lib/browser.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script type="module" src="./app.js"></script>

  <footer id="mainFooter">
    <span>BeReal Museum is not affiliated with BeReal</span>
    <a href="privacy.html" target="_blank">Privacy Policy</a>
    <span>All data processed locally ‚Ä¢ Your privacy guaranteed</span>
  </footer>
</body>

</html>
